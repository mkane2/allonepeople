
<!DOCTYPE html>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://rawgit.com/susielu/d3-legend/master/d3-legend.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<link rel="stylesheet" href="https://bootswatch.com/4/pulse/bootstrap.min.css">

<style>
/*  div {
      padding: 5px;
  }*/
  .links line {
    stroke: #999;
    stroke-opacity: 1;
  }
  circle {
    /*stroke: #fff;*/
    stroke-width: 3px;
  }
/*  text {
    font-family: Arial, sans-serif;
    color: black;
    display: inline;
  }*/
  
  .tooltip {
    position: absolute;
    text-align: center;
    text-transform: capitalize;
    line-height: 0.5;
    width: auto;
    height: auto;
    padding: 5px;
    font: 12px sans-serif;
    background: white;
    border: 1px solid lightgrey;
    border-radius: 5px;
    pointer-events: none;
  }
  
  #viz, #text {
    border: 1px solid lightgrey;
    border-radius: 5px;
/*    max-height: 750px;*/
    height: 90vh;
  }
  
  #text {
    overflow-y: scroll;
    /*padding: 10px;*/
    counter-reset: footnotes;
  }
  
  a[aria-describedby="footnote-label"] {
    counter-increment: footnotes; /* 1 */
    text-decoration: none; /* 2 */
    color: inherit; /* 2 */
    cursor: default; /* 2 */
    outline: none; /* 2 */
  }
  
  a[aria-describedby="footnote-label"]::after {
    content: '[' counter(footnotes) ']'; /* 1 */
    vertical-align: super; /* 2 */
    font-size: 0.5em; /* 3 */
    margin-left: 2px; /* 4 */
    color: blue; /* 5 */
    text-decoration: underline; /* 5 */
    cursor: pointer; /* 5 */
  }
  
  a[aria-describedby="footnote-label"]:focus::after {
    outline: thin dotted;
    outline-offset: 2px;
  }
  
</style>

<body>
  <div class="container-fluid">
    <div class="jumbotron">
      <h2 class="display">All One People and Under One King</h2>
      <h3>Maeve Kane, University at Albany SUNY | <a href="twitter.com/maevekane">@MaeveKane</a></h3>
      <hr>
      
    </div>
    
    <div id="navigation">
      <div id="filters">
        <div class="form-group row">
          <div class="col">
            <label for="filter-fill">Color individuals by: </label>
            <select id="filter-fill" class="form-control">
              <option selected value="race">Race</option>
              <option value="gender">Gender</option>
              <option value="clan">Clan</option>
              <option value="modularity_class">Modularity Class</option>
              <option value="role">Role</option>
            </select>
          </div>
          
          <div class="col">
            <label for="filter-stroke">Color individual outlines by: </label>
            <select id="filter-stroke" class="form-control">
              <option selected value="race">Race</option>
              <option value="gender">Gender</option>
              <option value="clan">Clan</option>
              <option value="modularity_class">Modularity Class</option>
              <option value="role">Role</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
        <label for="selected-year">Year: </label><input type="range" name="year" class="slider form-control" id="selected-year" value="1733" min="1733" max="1746" >
        <span class="slider_label h5"></span>
        </div>
      </div>
      
      <div id="legend"></div>
      <div class="row">
        <div class="col-sm-8 ml-3 mr-2 p-0" id="viz"></div>
        <div class="col ml-2 mr-3 py-2" id="text"><p>The 1711 construction of Queen Anne’s Chapel in Fort Hunter was intended to serve many goals for the Iroquois and New York colonial leaders who requested it, the British metropolitan officials who funded it, and the Iroquois and settler congregants who attended it.  Peter Schuyler, mayor of Albany, and the 'Four Indian Kings' (actually three young Mohawks and a Mahican without real authority) traveled to London in 1710 to more firmly tie British imperial interests to the defense of New York and Native communities against French <a aria-describedby="footnote-label" href="#incursion">incursion.</a>  Queen Anne funded the construction of a fort and a chapel within its walls, hoping to build on previously spotty Dutch and Anglican conversion efforts among the Mohawk and prevent further Catholic conversions by French <a aria-describedby="footnote-label" href="#jesuits">Jesuits.</a>  For the Anglican Mohawks at Tionondoroge and the nearby Dutch, English, Scots, Irish and Palatine German settlers and enslaved Africans who attended service and baptized their children at Queen Anne’s Chapel, the spiritual community both bound their entangled communities together and reinforced ethnic and racial distinctions within this mixed congregation.</p><p>The communities surrounding Fort Hunter which attended service and baptized their children at Queen Anne’s Chapel were mixed and varied.  The Mohawk community of Tionondoroge, where most of the Iroquois Fort Hunter congregants lived, had a long history of mixed material culture in which European goods were used and reworked to fit indigenous contexts, as well as a hybrid practice of Christianity which blended indigenous, Catholic, and Protestant <a aria-describedby="footnote-label" href="#elements">elements.</a>  As a result of a long-disputed land purchase, Dutch and English residents of Albany settled near Fort Hunter and brought enslaved Africans with <a aria-describedby="footnote-label" href="#them">them.</a> In addition to these groups, in 1710 New York governor Robert Hunter sponsored the settlement of thousands of Palatine German refugees in the pine barrens of the Mohawk and Hudson Valleys in a scheme to make naval stores for the Royal Navy and provide refuge for Protestants displaced by war in <a aria-describedby="footnote-label" href="#europe">Europe.</a>  When the pitch scheme turned sour, delegations of Palatines established friendly relations with Schoharie Valley Mohawks and settled instead on fertile farmland along Schoharie Creek, angering Dutch and English elites in Albany and Governor Hunter, all of whom had begun speculating on the land along Schoharie Creek despite Mohawk <a aria-describedby="footnote-label" href="#objections">objections.</a>  By 1753, the Palatines and Schoharie Valley Mohawks petitioned the New York governor together to make an allowance for the Palatines to remain on the land they had settled, “for we are on[e] church and we will not part.  We are grown up together and we intend to live our lifetime together as <a aria-describedby="footnote-label" href="#brothers">Brothers.”</a>  After 1718, Ulster Scots and Protestant Irish filtered into the area as well, including William Johnson, who arrived in 1738 to administer land his uncle had bought in the area.6  In addition, some Mahicans moved into the area seeking agricultural work with European landowners or as indentured servants.7  In this mixed landscape, people from two Native nations with very different relations to colonialism, European ethnic groups at odds with one another, and enslaved Africans all attended church and had their children baptized at Queen Anne's Chapel.  The network of relations documented by these baptisms made visible the ways in which ethnic and racial boundaries were made, maintained, and occasionally crossed.</p></div>
        
      </div>
    </div>
  <div class="row"><div class="col">
    </br>
    <h6 class="text-muted">Presented for the William and Mary Quarterly Digital Research in Early America Forum at University of California Irvine, October 11-12 2018. Special thanks to Nick Schiraldi of UAlbany’s Academic and Research Computing Center.</h6>
    <hr>
    <ol>
      <li id="incursion">Daniel K Richter, “Cultural Brokers and Intercultural Politics: New York-Iroquois Relations, 1664-1701,” The Journal of American History 75, no. 1 (1988): 40–67; Daniel K. Richter, “Some of Them . . . Would Always Have a Minister with Them: Mohawk Protestantism 1683-1791,” American Indian Quarterly 16, no. 4 (Autumn 1992): 471–84. Daniel K. Richter, The Ordeal of the Longhouse: The Peoples of the Iroquois League in the Era of European Colonization (Chapel Hill: Published for the Institute of Early American History and Culture, Williamsburg, Virginia, by the University of North Carolina Press, 1992); David Preston, The Texture of Contact : European and Indian Settler Communities on the Frontiers of Iroquoia, 1667-1783 (Lincoln: University of Nebraska Press, 2009); Gail D MacLeitch, Imperial Entanglements: Iroquois Change and Persistence on the Frontiers of Empire (Philadelphia: University of Pennsylvania Press, 2011); Edward Countryman, “Toward a Different Iroquois History,” ed. Jon Parmenter et al., The William and Mary Quarterly 69, no. 2 (2012): 347–60, https://doi.org/10.5309/willmaryquar.69.2.0347; Daniel R. Mandell, “‘Turned Their Minds to Religion’: Oquaga and the First Iroquois Church, 1748-1776,” Early American Studies: An Interdisciplinary Journal 11, no. 2 (2013): 211–42, https://doi.org/10.1353/eam.2013.0017. <a href="#text" aria-label="Back to content">↵</a></li>
      <li id="jesuits">See for example Daniel Richter, “Cultural Brokers and Intercultural Politics: New York-Iroquois Relations.” The Journal of American History. June 1988, Vol 75: 41; James Hart Merrell, Into the American Woods : Negotiators on the Pennsylvania Frontier. New York: Norton, 1999; Richard White,  The Middle Ground : Indians, Empires, and Republics in the Great Lakes Region, 1650-1815.  New York: Cambridge University Press, 1991; Margaret Szasz, editor.  Between Indian and White Worlds: The Cultural Broker.  Norman OK: University of Oklahoma Press.  1994; Robert Grumet, editor. Northeastern Indian Lives, 1632-1816. Amherst: University of Massachusetts Press.  1996; Nancy Hagedorn, “Brokers of Understanding: Interpreters as Agents of Cultural Exchange in Colonial New York.” New York History. Fall 1995, Vol 76: 379-408; Laura Johnson, “Goods to Clothe Themselves.” Winterthur Portfolio 43, no. 1 (2009); Timothy J Shannon, Indians and Colonists at the Crossroads of Empire : The Albany Congress of 1754. Ithaca, N.Y: Cornell University Press ; New York State Historical Association, 2000; Peter C. Mancall, and James Hart Merrell. American Encounters : Natives and Newcomers from European Contact to Indian Removal, 1500-1850. New York: Routledge, 2000; Jane T. Merritt, At the Crossroads : Indians and Empires on a Mid-Atlantic Frontier, 1700-1763. Omohundro Institute of Early American History & Culture. Chapel Hill: University of North Carolina Press, 2003;  Timothy J. Shannon, “Dressing for Success on the Mohawk Frontier: Hendrick, William Johnson, and the Indian Fashion.” The William and Mary Quarterly 53, no. 1 (1996): 13–42; Nancy Hagedorn, “Brokers of Understanding: Interpreters as Agents of Cultural Exchange in Colonial New York,” New York History 76, no. 4 (1995): 379–408.  For a critique of this focus on the male diplomatic encounter, see Ann M. Little, "Gender and Sexuality in the North American Borderlands, 1492–1848." History Compass 7, no. 6 (2009): 1606-1615.<a href="#text" aria-label="Back to content">↵</a></li>
      <li id="elements">Susan Sleeper-Smith,  Indian women and French men: rethinking cultural encounter in the Western Great Lakes. University of Massachusetts Press, 2001; Michele Mitchell, "Turns of the Kaleidoscope: Race, Ethnicity, and Analytical Patterns in American Women's and Gender History." Journal of Women's History  25:4 (2013): 46-73; Morrissey, "Kaskaskia Social Network.”  For an examination of the importance of nation, ethnicity, and indigenous political power to Native women's intermarriage, see Kathleen DuVal, “Indian Intermarriage and Métissage in Colonial Louisiana”. The William and Mary Quarterly 65:2, 2008: 267–304. http://www.jstor.org/stable/25096786.  For one case of a female diplomatic broker in eighteenth century Iroquoia, see Jon Parmenter, "Isabel Montour: Cultural Broker on the Eighteenth-Century Frontiers of New York and Pennsylvania." In Ian K. Steele and Nancy Rhoden, eds.,The Human Tradition in Colonial America, Wilmington, Delaware: Scholarly Resources Press, 1999. 141–59; and Alison Duncan Hirsch, "'The Celebrated Madame Montour': Interpretess across Early American Frontiers", Explorations in Early American Culture 4 (2000): 81–112.<a href="#text" aria-label="Back to content">↵</a></li>
      <li id="them">Erik R. Seeman, "Uncovering Hudson Valley Indian History." Reviews in American History 41:2 (2013): 191-196; Brenda Macdougall. “Speaking of Metis: Reading Family Life into Colonial Records.” Ethnohistory 61:1 (Winter 2014), 31-32; Gunlog Fur, A Nation Of Women: Gender And Colonial Encounters Among The Delaware Indians. University of Pennsylvania Press, 2012; Merritt, 51-59 passim.<a href="#text" aria-label="Back to content">↵</a></li>
      <li id="europe">Sir William Johnson to the Earl of Loudon, “Information of an Onondaga Indian Called by the English Corn-Milk,” Fort Johnson, March 4, 1757, Huntington Library. LO 2971<a href="#text" aria-label="Back to content">↵</a></li>
    </ol>
  </div></div>
</div>
  <script>
    var parentDiv = document.getElementById("viz");
    //var width = 800;
    //var height = 650;
    var width = parentDiv.clientWidth;
    var height = parentDiv.clientHeight;
      
    //slider start year
    var selectedYear = 1733;
    $("#selected-year").change(function(){
      selectedYear = $(this).val();
      showLinkLines();
      showText();
    });
    
    // label year slider
    $('.slider').on('input change', function(){
          $(this).next($('.slider_label')).html(this.value);
        });
      $('.slider_label').each(function(){
          var value = $(this).prev().attr('value');
          $(this).html(value);
        }); 
    
    // variable to store button coloring
    var colorFillCategory = ['race'];
    var colorStrokeCategory = ['race'];
    
    // filter based on gender or color
    $("#filter-fill").change(function(){
      colorFillCategory = $(this).val();
      updateNodeColor()
    });
    
    $("#filter-stroke").change(function(){
      colorStrokeCategory = $(this).val();
      updateNodeOutline()
    });
    
    //var selectedYear = 1733;
    //$(".selected-year").click(function(){
    //  selectedYear = $(this).val();
    //  console.log(selectedYear);
    //  showLinkLines();
    //  showText();
    //});
    
    // preallocate linkedbyindex
    let linkedByIndex = {};
    
    // build the svg for the viz
    var svg = d3.select("#viz")
      .append("svg")
      .attr("preserveAspectRatio", "xMinYMin meet")
      .attr("viewBox", "0 0 " + width + " " + height)
      .call(d3.zoom().on("zoom", function() {
        svg.attr("transform", d3.event.transform)
      }))
      .on("dblclick.zoom", null)
      .append("g");
    
    //set color scale
    //how to update legend to reflect changing labels on color select?
    var color = d3.scaleOrdinal()
      .domain(["Native", "White", "Black", "Unknown", "Male", "Female", "Wolf", "Turtle", "Bear"])
      .range(["#ea5f5f",
              "#ffb14e",
              "#fff200",
              "#75fa7a",
              "#009b7b",
              "#2c15b2",
              "#9d02d7",
              "#000000",
              "#9a9a9a"]);
    
    var legend = d3.select("svg");
    
    legend.append("g")
      .attr("class", "legendOrdinal")
      .attr("transform", "translate(20,20)");
    
    var legendOrdinal = d3.legendColor()
      .shapePadding(10)
      .scale(color);
    
    legend.select(".legendOrdinal")
      .call(legendOrdinal);
    
    // use force simulation
    var simulation = d3.forceSimulation()
      .force("collide", d3.forceCollide().radius(function(d) { return d.betweenesscentrality/3000 + 15; }))
      .force("link", d3.forceLink().id(function(d) {
        return d.name;
      }).strength(0.5))
      .force("charge", d3.forceManyBody())
      .force("center", d3.forceCenter(width / 2, height / 2));
    
    // Define the div for the tooltip
    var div = d3.select("body").append("div")
      .attr("class", "tooltip");
    var toggle = 0;
    
    // load the data, pass in error, graph variables
    d3.json("force.json", function(error, graph) {
      if (error) throw error;
      
      var link = svg.append("g")
        .attr("class", "links")
        .selectAll("line")
        .data(graph.links)
        .enter().append("line");
      //.attr("stroke-width", function(d) { return Math.sqrt(d.value); });
      
      var node = svg.selectAll("circle")
        .data(graph.nodes)
        .enter().append("circle")
        .attr("r", function(d) { return d.betweenesscentrality/3000 + 5; })
        .attr("fill", function(d) {
          return color(d[colorFillCategory]);
        })
        .attr("stroke", function(d) {
          return color(d[colorStrokeCategory]);
        })
        .on("mouseover", function(d) {
          div.html("<h6>" + d.name + "</h6><strong>Race:</strong> " + d.race + "</br><strong>Gender:</strong> " + d.gender + "</br><strong>Clan:</strong> " + d.clan + "</br><strong>First appeared as:</strong> " + d.role + "</br><strong>Subcommunity:</strong> " + d.modularity_class)
            .style("left", (d3.event.pageX) + "px")
            .style("top", (d3.event.pageY - 28) + "px")
            .style("opacity", 1);
        })
        .on("mouseout", function(d) {
          div.transition()
            .duration(50) // duration is critical for mouse over.. if a user is moving the mouse fast the tooltip is not responsive
            .style("opacity", 0);
        })
        .call(d3.drag()
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended))
        .on('dblclick', connectedNodes);
      
      var text = svg.selectAll("text")
        .data(node)
        .enter()
        .append("text");
      
      var labels = text
        .attr("x", function(d) {
          return d.cx
        })
        .attr("y", function(d) {
          return d.cy
        })
        .text(function(d) {
          return "( " + d.cx + ", " + d.cy + " )"
        })
      simulation
        .nodes(graph.nodes)
        .on("tick", ticked);
      simulation.force("link")
        .links(graph.links);
      function ticked() {
        link
          .attr("x1", function(d) {
            return d.source.x;
          })
          .attr("y1", function(d) {
            return d.source.y;
          })
          .attr("x2", function(d) {
            return d.target.x;
          })
          .attr("y2", function(d) {
            return d.target.y;
          });
        node
          .attr("cx", function(d) {
            return d.x;
          })
          .attr("cy", function(d) {
            return d.y;
          });
      }
      
      // mouse double click highlight is taken from this example:
      // http://www.coppelia.io/2014/06/finding-neighbours-in-a-d3-force-directed-layout-2/
      // we need to create an array of "connections" for quick lookup
      var linkedByIndex = {};
      for (i = 0; i < graph.nodes.length; i++) {
          linkedByIndex[i + "," + i] = 1;
      };
      
      // Loop over each "link" and determine if they are connectioned
      graph.links.forEach(function (d) {
          linkedByIndex[d.source.index + "," + d.target.index] = 1;
      });
      
      // define a "lookup" function to get connections
      function neighboring(a, b) {
          return linkedByIndex[a.index + "," + b.index];
      };
      links = d3.selectAll('line');
      
      // set opacity based on connections
      function connectedNodes() {
          if (toggle == 0) {
              // select the nodes
              d = d3.select(this).node().__data__;
              // loop over each node and style
              node.style("opacity", function (o) {
                  // ? is a conditional operator of the form condition ? value-if-true : value-if-false
                  return neighboring(d, o) | neighboring(o, d) ? 1 : 0.15;
              });
              toggle = 1;
          } else {
              node.style("opacity", 1);;
              toggle = 0;
          }
      };
    });
    function dragstarted(d) {
      if (!d3.event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
    };
    function dragged(d) {
      d.fx = d3.event.x;
      d.fy = d3.event.y;
    };
    function dragended(d) {
      if (!d3.event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    };
    
    /* ------------ Update Node Color --------------*/
    // function to get all nodes, and change the color. Follow the general update pattern
    // https://bl.ocks.org/mbostock/3808218
    function updateNodeColor(){
      var allCircles = svg.selectAll('circle')
      
      // loop over each node, and update color attribute
      allCircles.attr("fill", function(d,i){
        return color(d[colorFillCategory])
      });
      allCircles.exit().remove()
    };
    
    function updateNodeOutline(){
      var allCircles = svg.selectAll('circle')
      
      // loop over each node, and update color attribute
      allCircles.attr("stroke", function(d,i){
        return color(d[colorStrokeCategory])
      });
      allCircles.exit().remove()
    };
    
    function showLinkLines(){
      var filterId = [];
      var allLines = svg.selectAll('line');
      var allNodes = svg.selectAll('circle');
      // loop over each node, and update color attribute
      allLines.style("stroke-opacity", function(d,i){
        return d.year <= parseInt(selectedYear) ? 0.7 : 0
      });
      allLines.exit().remove()
      allNodes.style('opacity',function(d,i){
        return (d.year <= parseInt(selectedYear))? 1 : 0
      });
      allNodes.exit().remove()
    };
    
    function showText(){
      $("#text").empty();
      var cat
      $.getJSON('https://api.myjson.com/bins/bb2f8', function(data){
        for (var i = 0; i < data.length; i++){
          if (data[i].year == selectedYear) {
            cat = data[i].text
          }
        }
        console.log(cat);
        console.log(selectedYear);
        $("#text").append(cat)
      });
    };
  </script>
</body>

</html>
